<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Timelønsberegner med Tillæg</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input, select, button { margin: 5px 0; padding: 5px; }
  table { border-collapse: collapse; width: 100%; margin-top: 15px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  .deleteBtn { background-color: #e74c3c; color: white; border: none; padding: 5px 10px; cursor: pointer; }
  .deleteBtn:hover { background-color: #c0392b; }
</style>
</head>
<body>

<h2>Timelønsberegner</h2>

<label for="timelon">Timeløn (kr.):</label><br />
<input type="number" id="timelon" min="0" step="0.01" placeholder="Fx 150" /><br />

<label for="tillaeg">Tillæg pr. time (kr.):</label><br />
<input type="number" id="tillaeg" min="0" step="0.01" placeholder="Fx 50" /><br />

<label for="amb">AM-bidrag (%):</label><br />
<input type="number" id="amb" min="0" max="100" step="0.1" placeholder="Fx 8" value="8" /><br />

<label for="skat">Skat (%):</label><br />
<input type="number" id="skat" min="0" max="100" step="0.1" placeholder="Fx 37" value="37" /><br />

<hr />

<h3>Tilføj Vagt</h3>

<label for="dato">Dato:</label><br />
<input type="date" id="dato" /><br />

<label for="timerUdenVagt">Timer uden tillæg:</label><br />
<input type="number" id="timerUdenVagt" min="0" step="0.1" placeholder="Fx 5" /><br />

<label for="timerMedVagt">Timer med tillæg:</label><br />
<input type="number" id="timerMedVagt" min="0" step="0.1" placeholder="Fx 2" /><br />

<button id="tilfoejVagtBtn">Tilføj vagt</button>

<table>
  <thead>
    <tr>
      <th>Dato</th>
      <th>Timer uden tillæg</th>
      <th>Timer med tillæg</th>
      <th>Slet</th>
    </tr>
  </thead>
  <tbody id="vagtTabelBody"></tbody>
</table>

<hr />

<div id="totalTimerLøn"></div>

<script>
  // Input elementer
  const timelonInput = document.getElementById("timelon");
  const tillaegInput = document.getElementById("tillaeg");
  const ambInput = document.getElementById("amb");
  const skatInput = document.getElementById("skat");

  const datoInput = document.getElementById("dato");
  const timerUdenVagtInput = document.getElementById("timerUdenVagt");
  const timerMedVagtInput = document.getElementById("timerMedVagt");
  const tilfoejVagtBtn = document.getElementById("tilfoejVagtBtn");

  const vagtTabelBody = document.getElementById("vagtTabelBody");
  const totalTimerLønDiv = document.getElementById("totalTimerLøn");

  let vagter = [];

  // Tilføj vagt
  tilfoejVagtBtn.addEventListener("click", () => {
    const dato = datoInput.value;
    const timerUden = parseFloat(timerUdenVagtInput.value) || 0;
    const timerMed = parseFloat(timerMedVagtInput.value) || 0;

    if (!dato) {
      alert("Indtast venligst en dato.");
      return;
    }
    if (timerUden <= 0 && timerMed <= 0) {
      alert("Indtast venligst mindst en time (uden eller med tillæg).");
      return;
    }

    vagter.push({ dato, timerUden, timerMed });
    opdaterVagtTabel();
    opdaterTotal();
    gemData();

    // Nulstil inputfelter
    datoInput.value = "";
    timerUdenVagtInput.value = "";
    timerMedVagtInput.value = "";
  });

  // Opdater tabel med vagter
  function opdaterVagtTabel() {
    vagtTabelBody.innerHTML = "";
    vagter.forEach((vagt, index) => {
      const tr = document.createElement("tr");

      const tdDato = document.createElement("td");
      tdDato.textContent = vagt.dato;
      tr.appendChild(tdDato);

      const tdTimerUden = document.createElement("td");
      tdTimerUden.textContent = vagt.timerUden.toFixed(2);
      tr.appendChild(tdTimerUden);

      const tdTimerMed = document.createElement("td");
      tdTimerMed.textContent = vagt.timerMed.toFixed(2);
      tr.appendChild(tdTimerMed);

      const tdSlet = document.createElement("td");
      const sletBtn = document.createElement("button");
      sletBtn.textContent = "Slet";
      sletBtn.className = "deleteBtn";
      sletBtn.addEventListener("click", () => {
        vagter.splice(index, 1);
        opdaterVagtTabel();
        opdaterTotal();
        gemData();
      });
      tdSlet.appendChild(sletBtn);
      tr.appendChild(tdSlet);

      vagtTabelBody.appendChild(tr);
    });
  }

  // Opdater totaler og lønberegning
  function opdaterTotal() {
    const timelon = parseFloat(timelonInput.value);
    const tillaeg = parseFloat(tillaegInput.value) || 0;
    const amb = ambInput.value.trim() === "" ? 8 : parseFloat(ambInput.value);
    const skat = skatInput.value.trim() === "" ? 37 : parseFloat(skatInput.value);

    if (isNaN(timelon)) {
      totalTimerLønDiv.textContent = "Indtast en gyldig timeløn for at se totaler.";
      return;
    }

    let totalTimer = 0;
    let totalBrutto = 0;

    vagter.forEach(vagt => {
      totalTimer += vagt.timerUden + vagt.timerMed;
      totalBrutto += vagt.timerUden * timelon + vagt.timerMed * (timelon + tillaeg);
    });

    const efterAMB = totalBrutto * (1 - amb / 100);
    const efterSkat = efterAMB * (1 - skat / 100);

    totalTimerLønDiv.innerHTML = `
      <strong>Total arbejdstimer:</strong> ${totalTimer.toFixed(2)}<br>
      <strong>Bruttoløn:</strong> ${totalBrutto.toFixed(2)} kr.<br>
      <strong>Efter AM-bidrag (${amb}%):</strong> ${efterAMB.toFixed(2)} kr.<br>
      <strong>Efter skat (${skat}%):</strong> ${efterSkat.toFixed(2)} kr.
    `;
  }

  // Gem data i localStorage
  function gemData() {
    localStorage.setItem("vagter", JSON.stringify(vagter));
    localStorage.setItem("timelon", timelonInput.value);
    localStorage.setItem("tillaeg", tillaegInput.value);
    localStorage.setItem("amb", ambInput.value);
    localStorage.setItem("skat", skatInput.value);
  }

  // Hent data fra localStorage
  function hentData() {
    const gemteVagter = localStorage.getItem("vagter");
    if (gemteVagter) {
      vagter = JSON.parse(gemteVagter);
    }
    const gemtTimelon = localStorage.getItem("timelon");
    if (gemtTimelon !== null) timelonInput.value = gemtTimelon;

    const gemtTillaeg = localStorage.getItem("tillaeg");
    if (gemtTillaeg !== null) tillaegInput.value = gemtTillaeg;

    const gemtAmb = localStorage.getItem("amb");
    if (gemtAmb !== null) ambInput.value = gemtAmb;

    const gemtSkat = localStorage.getItem("skat");
    if (gemtSkat !== null) skatInput.value = gemtSkat;

    opdaterVagtTabel();
    opdaterTotal();
  }

  // Opdater total når timeløn, tillæg, AM eller skat ændres
  [timelonInput, tillaegInput, ambInput, skatInput].forEach(input => {
    input.addEventListener("input", () => {
      opdaterTotal();
      gemData();
    });
  });

  hentData();
</script>

</body>
</html>
